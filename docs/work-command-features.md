# ワークコマンド機能追加要件

## 概要

現在のオンラインコワーキングスペースシステムに、ユーザーのタスク管理と滞在時間管理機能を追加します。ユーザーはYouTubeライブチャットで特定のコマンドを使用して入室・退室でき、一定時間後に自動退室される機能を実装します。

## 新機能要件

### コマンド機能拡張

1. **入室コマンド**
   - コマンド形式: `/work タスク名`
   - 機能: ユーザーが指定したタスク名とともに入室
   - 例: `/work プログラミング学習`

2. **退室コマンド**
   - コマンド形式: `/finish`
   - 機能: ユーザーが明示的に退室

3. **自動退室機能**
   - 条件: 入室から2時間経過
   - 機能: システムが自動的にユーザーを退室させる

### データモデル拡張

現在のデータモデルに以下の情報を追加します：

1. **座席（Seat）データの拡張**
   - `task`: ユーザーが取り組んでいるタスク名
   - `enterTime`: 入室時刻（タイムスタンプ）
   - `autoExitScheduled`: 自動退室予定時刻（タイムスタンプ）

### UI変更

1. **ユーザーカード表示**
   - ユーザー名
   - アバター画像
   - タスク名
   - 経過時間表示（または残り時間）

2. **全体レイアウト**
   - 提供されたデザインサンプルをベースにしたモダンなUI
   - サイレントルーム（フォーカスルーム）のコンセプトを取り入れる
   - ポモドーロタイマーの統合

## 技術的な実装詳細

### バックエンド（API）拡張

1. **コマンド処理機能の強化**
   - `/api/youtube-comments/route.ts` の拡張
   - コマンドパターンの追加 (`/work` と `/finish`)
   - タスク名の抽出処理

2. **座席データ管理**
   - `/api/seats/route.ts` の拡張
   - タスク情報および時間情報の記録
   - 自動退室処理のためのスケジューリング

3. **自動退室処理**
   - バックグラウンドプロセスまたはスケジュールタスク実装
   - 入室時刻から2時間後に退室処理を実行
   - 定期的に期限切れのセッションをチェック

### フロントエンド拡張

1. **UI実装**
   - 提供されたデザインに基づくコンポーネント作成
   - ユーザーカードの実装
   - 残り時間表示の実装

2. **リアルタイム更新**
   - Server-Sent Events (SSE) を使用した残り時間の更新
   - ユーザー状態変更の反映

## 実装計画

1. **データモデル拡張**
   - MongoDB のスキーマ拡張
   - タスク名と時間情報の追加

2. **バックエンドAPI拡張**
   - コマンド処理の追加
   - 自動退室機能の実装

3. **フロントエンドUI実装**
   - 新しいコンポーネントの作成
   - 提供されたデザインの適用

4. **テストとデバッグ**
   - コマンド処理のテスト
   - 自動退室機能のテスト
   - UIの動作確認

## 留意点

1. **データベース移行**
   - 既存のユーザーデータを損なわないよう注意
   - 下位互換性の確保

2. **エラーハンドリング**
   - 無効なコマンド形式への対応
   - タスク名が長すぎる場合の対応

3. **パフォーマンス**
   - 自動退室処理による過負荷防止
   - 効率的なデータベースクエリの実装 