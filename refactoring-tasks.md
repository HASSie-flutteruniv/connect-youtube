# リファクタリングタスクリスト

**現在の作業フェーズ:** フェーズ1 - コアロジックの整理と責務分離

## フェーズ0 - 基盤整備（完了）

- [x] Jest / React Testing Libraryの統合
- [x] 基本的なテストカバレッジレポートの設定
- [x] ESLint / Prettierルールの統一とCIでのチェック
- [x] `lib/youtube.js` → `lib/youtube.ts` への完全な移行
- [x] 不要な`.js`ファイルの削除
- [x] `scripts`内の`.js`ファイルを可能な範囲で`.ts`に移行
- [x] `package.json`の不要な依存関係をレビュー（問題なしを確認）
- [x] 依存関係バージョンの更新検討（大きな問題なしを確認）

## フェーズ1 - コアロジックの整理と責務分離

- [x] Zustandによる状態管理導入
  - [x] Pomodoroタイマーロジックのリファクタリング

- [x] YouTube関連の責務分離
  - [x] コメント処理とコマンド実行の分離
  - [x] APIエンドポイントの再設計
  - [x] エラーハンドリングの強化

- [x] SSE（Server-Sent Events）通信の改善
  - [x] 複数コネクション対応の改善
  - [x] エラーハンドリングの強化
  - [x] 再接続ロジックの実装
  - [x] 接続断からの回復機能の実装
  - [x] クライアント側の再接続処理の改善

- [x] 自動退室ロジックの整理
  - [x] バックエンドのロジックをライブラリに集約
  - [x] フロントエンドの表示ロジックを分離

## フェーズ2 - プレゼンテーション層の整理

- [ ] コンポーネントの責務分離
  - [ ] 表示関連コンポーネントの分割
  - [ ] ロジック部分とUIの分離
  - [ ] Propsの型定義強化

- [ ] シャドーCNとTailwindの最適化
  - [ ] スタイルシステムの統一
  - [ ] コンポーネント間の一貫性確保

- [ ] アクセシビリティの改善
  - [ ] ARIA属性の適切な利用
  - [ ] キーボードナビゲーションの改善

## フェーズ3 - パフォーマンス最適化

- [ ] レンダリングパフォーマンスの最適化
  - [ ] 不要なレンダリングの削減
  - [ ] メモ化による最適化の検討

- [ ] バンドルサイズの最適化
  - [ ] 使用していないコードの削除
  - [ ] 重複コードの統合
  - [ ] コードスプリッティングの検討

- [ ] API通信の最適化
  - [ ] データフェッチングの統合
  - [ ] キャッシュ戦略の実装

## フェーズ 4: テストカバレッジ向上

### ユニットテスト
- [ ] `lib/utils.ts` 内のヘルパー関数のユニットテストを作成・拡充
- [ ] `lib/messages.ts` のテンプレート生成関数のユニットテストを作成
- [ ] `UserCard`, `PomodoroTimer` など主要コンポーネントの表示ロジックに関するユニットテストを作成

### インテグレーションテスト
- [ ] APIエンドポイントのテスト環境（Mock Service Worker or Supertest）をセットアップ
- [ ] コマンド処理APIのインテグレーションテストを作成
- [ ] SSE接続とデータフローに関するインテグレーションテストを作成
- [ ] DB操作を含むシナリオのインテグレーションテストを作成
- [ ] フロントエンドとバックエンドを連携させたテストシナリオ（コマンド送信 → UI更新など）を作成

### E2Eテスト (オプション)
- [ ] PlaywrightなどのE2Eテストフレームワークを導入
- [ ] 主要ユーザーフロー（入室、退室、自動退室）のE2Eテストを作成

## フェーズ 5: ドキュメントとクリーンアップ

### ドキュメント更新
- [ ] `docs/` 内のドキュメント（特に `refactoring-strategy.md` や関連文書）をリファクタリング内容に合わせて更新
- [ ] コード内のコメント（JSDoc/TSDoc）を充実させる (特にAPI、複雑なロジック)

### コードクリーンアップ
- [ ] 未使用の変数、関数、インポート、コンポーネントを特定し削除
- [ ] `console.log` 等のデバッグコードを削除または適切なロガーに置き換え
- [ ] `.env.example` ファイルを作成・更新し、必要な環境変数を明記 